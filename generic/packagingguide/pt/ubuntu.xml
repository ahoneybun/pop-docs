<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
	"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % globalent SYSTEM "../../../libs/global.ent">
%globalent;
<!ENTITY % cdo-C SYSTEM "../../../libs/cdo-C.ent">
%cdo-C;
<!ENTITY % pg-common SYSTEM "../pg-common.ent">
%pg-common;
<!ENTITY % xinclude SYSTEM "../../../libs/xinclude.mod">
%xinclude;
<!ENTITY language "en">
]>
<chapter id="ubuntu-chap" status="complete">
	<title>Empacotamento no Ubuntu</title>

	<sect1 id="ubuntu-upload" status="complete">
		<title>Revendo e Transferindo para a Internet</title>

		<para>Assim que tiver criado um pacote fonte (ou um pacote completamente novo ou apenas uma actualização/correcção de erros), quererá distribuir o seu pacote para que outras pessoas possam usufruir do seu trabalho duro. A maneira mais eficaz para o fazer para o &ubuntu; é contribuir com o seu pacote para o repositório Universe. A comunidade de programadores que são responsáveis pelo repositório Universe são conhecidos por Master of the Universe (<ulink url="https://wiki.ubuntu.com/MOTU">MOTU</ulink>). O <ulink url="http://revu.tauware.de">REVU</ulink> é uma ferramente baseada em web que dá às pessoas um local para enviar os seus pacotes fontes para outras pessoas analisarem e para os MOTUs o reverem de forma estruturada.</para>

		<sect2 id="contribute-as-uploader">
			<title>Contribuindo com pacotes</title>
		
			<para>Primeiro precisa da sua <ulink url="https://wiki.ubuntu.com/GPGKey">Chave GPG</ulink> adicionada ao porta-chaves REVU. Isto assegurará no futuro a proveniência dos pacotes e permitirá efectuar uma gestão mais cuidada das contribuições.</para>
	
			<para>REVU uses your <ulink url="https://launchpad.net">Launchpad</ulink> account to look up your <application>gpg</application> key so make sure you have a Launchpad account and you have put your <application>gpg</application> key in your user profile there. Once this is one you can join the <ulink url="https://launchpad.net/people/ubuntu-universe-contributors">Universe Contributors</ulink> team and then email <ulink url="mailto:admin@tiber.tauware.de">admin@tiber.tauware.de</ulink> asking for your <application>gpg</application> key to be updated on REVU. When this is done you will be able to upload your packages. You don't	need a password to upload packages, only to log in to the website and to reply to comments.</para>

			<note><para>It is not necessary to have your key signed by others to upload to REVU, but
					it is a good idea to have it done at some point.</para></note>
			
			
			<sect3 id="upload-your-packages">
				<title>Uploading your packages</title>

				<para>O REVU usa para enviar o <application>dput</application>. A versão do &ubuntu; do <application>dput</application> já conhece o REVU por isso não precisa de mudar nenhuns ficheiros de configuração. Apenas envia pacotes assinados, e ao contrário de outros repositórios, deve incluir sempre o ficheiro original, de outra forma os revisores não podem analisar o seu pacote extraído. Para o fazer, use as opções "-S -sa" com o <application>debuild</application> ou com o <application>dpkg-buildpackage</application> para construir apenas o pacote fonte e incluir a fonte original no envio.</para>
				
				<para>After the source package is built, you can use
					<application>dput</application> with the above config file changes to
					upload it by specifying just the <filename>_source.changes</filename>
					file that was created: </para>

				<screen>dput revu *_source.changes</screen>

				<note><para>If you are reuploading a changed package (after receiving
						reviews), you may get an error like this:</para>
					
				<screen>
Upload package to host revu
Already uploaded to tauware.de
Doing nothing for myapp_source.changes</screen>
			
				<para>To fix, add the -f option to dput to force the upload or remove the
					<filename>.upload</filename> file that was created by
					<application>dput</application>.</para></note>
			
				<para>Processing of uploads is done every five minutes, so if your upload does not show up,
				please contact the REVU administrators by email, or join the &irc-network; IRC channel #ubuntu-motu.</para>
		
			</sect3>
		
			<sect3 id="howto-login">
				<title>How to login to REVU</title>
			
				<para>After your first upload, you are registered automatically in the
					database and assigned a random password. On the <ulink url="http://revu.tauware.de">REVU</ulink> website, use the email
					address you used in the changelog file of your upload as the login and
					click the 'recover password' link. You will be taken to a page that
					has your encrypted password with instructions for decrypting
					it.</para>
				
			</sect3>

			<sect3 id="view-and-comment-uploads">
				<title>View and comment uploads</title>
			
				<para>Packages uploaded to REVU are public. You can browse them without logging
					in to the system. However, commenting on uploads is available only to registered
					users. As an uploader, you can only comment on your own uploads. This can be
					useful to give reviewers some info on the changes you have made between two
					uploads of your packages.</para>

			</sect3>

			<sect3 id="additional-rules">
				<title>Regras adicionais</title>
		
				<itemizedlist>

					<listitem><para>You must have reviewed the package for known security
							vulnerabilities and must provide patches for them.</para></listitem>
					
					<listitem><para>O pacote pode ser recusado devido a problemas de segurança conhecidos.</para></listitem>
					
					<listitem><para>You must have included a copyright and license file, and those
							must allow inclusion of the package in the Universe component
							and redistribution via Ubuntu mirrors.</para></listitem>
					
					<listitem><para>O pacote dever ser reconhecido com sendo capaz de compilar sobre o componente principal da versão actual estável do &ubuntu;. É permitido requerer outros pacotes já existentes no Universe.</para></listitem>
				</itemizedlist>
			</sect3>

			<sect3 id="getting-help">
				<title>Obter Ajuda</title>
				<para>Se precisar de ajuda nestes passos, ou se tem questões sobre o REVU, pode perguntar no  #ubuntu-motu em &irc-network; IRC network.</para>
			</sect3>

		</sect2>

	</sect1>

	<sect1 id="ubuntu-sync" status="complete">
		<title>Merges and Syncs</title>



		<important><para><emphasis role="bold">Requisitos:</emphasis> build-essential, automake, gnupg, lintian, fakeroot, patchutils, debhelper e <xref linkend="gs-pbuilder"/>.</para></important>
		
		<para>O &ubuntu; é baseado na distribuição Linux Debian e usa o mesmo sistema de gestão de pacotes (APT). No inicio de cada ciclo de desenvolvimento do &ubuntu;, os pacotes no &ubuntu; são actualizados pelos do ramo instável do Debian. No entanto, porque o &ubuntu; não é igual ao Debian, alguns dos pacotes precisam de ser modificados para trabalharem com o &ubuntu;. Podem existir ainda correcções de erros que os programadores do &ubuntu; introduziram nos pacotes. Pode determinar se isto aconteceu olhando para a versão do pacote. Se a versão do pacote incluiu ubuntu nela (um exemplo podia ser gimp-2.2.9-3ubuntu2), então os programadores fizeram  mudanças, e não é mais igual ao pacote Debian. Existem mais de 1000 desses pacotes modificados no repositório Universe.</para>
		
		<para>No inicio de cada ciclo de desenvolvimento Ubuntu, é tomada uma decisão em relação a estes pacotes com versão Ubuntu. Claro que se a versão Debian não mudou desde o último lançamento &ubuntu;, então não é necessário mudar nada. No entanto, se existir uma nova versão do pacote no Debian, então uma de duas coisas devem acontecer. Se todas as razões para as modificações do Ubuntu (correcções de erros, dependências, etc.) estiverem corrigidas no novo pacote Debian, então podemos usar o pacote Debian directamente. Esta decisão é chamada de <emphasis>sync</emphasis>. No entanto, se a nova versão Debian tem os mesmos problemas que causaram a criação da versão Ubuntu, então essas mudanças precisam de ser aplicadas à nova versão Debian também. Esta decisão é chamada <emphasis>merging</emphasis>.</para>
		<sect2 id="merge-tutorial">
			<title>Manual de Merging</title>
			<para>O processo de fusão envolve olhar para as mudanças nos pacotes fonte do Debian e Ubuntu e determinar o que mudou e quais as mudanças especificas Ubuntu. Deixe-nos olhar agora para um exemplo, um programa popular de criação de cd's chamado <application>xcdroast</application>.</para>
			<para>Para começar, crie uma directoria para ficar com o nosso projecto, a seguir navegue até lá:</para>
			<screen>
mkdir ~/xcdroast
cd ~/xcdroast</screen>
			<para>Agora descarregue todos os pacotes fontes envolvidos nesta directoria:</para>
			<itemizedlist>
				<listitem><para>O ficheiro fonte do <application>xcdroast</application> que é usado por todas as versões:</para>
					<itemizedlist>
						<listitem>
<para><ulink url="http://snapshot.debian.net/archive/2006/01/16/debian/pool/main/x/xcdroast/xcdroast_0.98+0alpha15.orig.tar.gz">xcdroast_0.98+0alpha15.orig.tar.gz</ulink></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Os ficheiros dos pacotes fonte do &ubuntu; Breezy</para>
					<itemizedlist>
						<listitem><para>
<ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-1.1ubuntu1.dsc">xcdroast_0.98+0alpha15-1.1ubuntu1.dsc</ulink></para>
						</listitem>
						<listitem><para>
<ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-1.1ubuntu1.diff.gz">xcdroast_0.98+0alpha15-1.1ubuntu1.diff.gz</ulink></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Os pacotes fonte do Debian de que os pacotes Breezy derivam:</para>
						<itemizedlist>
							<listitem>
<para><ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-1.1.diff.gz">xcdroast_0.98+0alpha15-1.1.diff.gz</ulink></para>
							</listitem>
							<listitem>
<para><ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-1.1.dsc">xcdroast_0.98+0alpha15-1.1.dsc</ulink></para>
							</listitem>
						</itemizedlist>
				</listitem>
				<listitem>
					<para>O novo pacote fonte Debian de que os pacotes Dapper derivarão:</para>
					<itemizedlist>
						<listitem>
<para><ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-3.dsc">xcdroast_0.98+0alpha15-3.dsc</ulink></para>
						</listitem>
						<listitem>
<para><ulink url="http://doc.ubuntu.com/files/packagingguide/xcdroast_0.98+0alpha15-3.diff.gz">xcdroast_0.98+0alpha15-3.diff.gz</ulink></para>
						</listitem>
					</itemizedlist>
				</listitem>
			</itemizedlist>
			<note><para>Estes passos podem ainda ser dados procurando os pacotes Debian em <ulink url="packages.debian.org">packages.debian.org</ulink> e os pacotes Ubuntu em <ulink url="packages.ubuntu.com">packages.ubuntu.com</ulink>.</para></note>
		<tip><para>Um pacote muito útil para ter instalado quando faz fusões (ou outro empacotamento Ubuntu) é o <application>devscripts</application>. Se ainda não o tem instalado, instale-o antes de avançar.</para></tip>
			
			<para>Olhando para o changelog do &ubuntu; deve ser capaz de ver as diferenças esperadas entre o pacote Ubuntu e o pacote Debian a partir do qual derivou. Para o xcdroast, o changelog &ubuntu; pode ser encontrado em <ulink url="http://changelogs.ubuntu.com/changelogs/pool/universe/x/xcdroast/xcdroast_0.98+0alpha15-1.1ubuntu1/changelog"> changelogs.ubuntu.com</ulink>. Ele diz que o ficheiro .desktop foi corrigido e instalado correctamente para fechar um erro relatado em <ulink url="https://launchpad.net/malone/bugs/2698">Malone</ulink>.</para>
			
			<para>Agora analise as mudanças actuais nos pacotes fonte:</para>
			<screen>
debdiff xcdroast_0.98+0alpha15-1.1.dsc xcdroast_0.98+0alpha15-1.1ubuntu1.dsc | \
	ubuntu.debdiff | less ubuntu.debdiff</screen>
			
			<para>As linhas que começam com - foram removidas do pacote Debian, e aqueles que começam com + foram adicionadas ao pacote &ubuntu;:</para>
			<para>O seguinte é o que podemos ver:</para>
			<itemizedlist>
				<listitem>
					<para>Na debian/rules é usado install em vez de cp para instalar o ícone do xcdroast. Também, existe uma nova linha instalando o ficheiro .desktop.</para>
				</listitem>
				<listitem>
					<para>No debian/changelog as mudanças efectuadas são adicionadas ás entradas do changelog.</para>
				</listitem>
				<listitem>
					<para>In debian/dirs usr/share/applications has been added for the install lines above to
						work properly.</para>
				</listitem>
				<listitem>
					<para>foi adicionado xcdroast.desktop</para>
				</listitem>
			</itemizedlist>
			
			<para>Agora sabemos como é que a fonte do Ubuntu foi alterada. Agora necessitamos ver o que é que foi alterado nas fontes do Debian.</para>
			<screen>
debdiff xcdroast_0.98+0alpha15-1.1.dsc xcdroast_0.98+0alpha15-3.dsc &gt; debian.debdiff

less debian.debdiff</screen>
			<para>Existe muito mais neste debdiff do que no anterior. Uma maneira de termos uma ideia melhor do que mudou é ver que ficheiros foram mudados no debdiff:</para>
			
			<screen>grep diff debian.debdiff</screen>
			
			<para>Isto indica que o debian/postinst, debian/rules, debian/changelog, debian/doc-base.manual, debian/control, e debian/menu foram mudados na nova versão Debian.</para>
			<para>Assim podemos ver que precisamos de verificar o debian/rules para ver se as mudanças &ubuntu; foram feitas. Podemos também ver que o debian/dirs não foi modificado a partir da versão antiga Debian. Vamos olhar agora para os ficheiros. Podemos descomprimir o pacote fonte usando <application>dpkg-source</application>:</para>
			
			<screen>dpkg-source -x xcdroast_0.98+0alpha15-3.dsc</screen>
			
			<para>Isto irá descompactar o ficheiro  xcdroast_0.98+0alpha15.orig.tar.gz, criar uma directoria xcdroast-0.98+0alpha15, e aplicar as mudanças encontradas no xcdroast_0.98+0alpha15-3.diff.gz.</para>
			<para>Agora navegue para o directório debian:</para>
			
			<screen>dpkg-source -x xcdroast_0.98+0alpha15-3.dsc</screen>
			
			<para>Podemos ver em <filename>rules</filename> que as mudanças &ubuntu; não foram aplicadas à nova versão Debian. Isto significa que:</para>
			
			<screen>cp debian/xcdroast.xpm `pwd`/debian/$(PACKAGE)/usr/share/pixmaps</screen>
			
			<para>...deve ser mudado para:</para>
			
			<screen>
#cp debian/xcdroast.xpm `pwd`/debian/$(PACKAGE)/usr/share/pixmaps

#install desktop and icon
install -D -m 644 $(CURDIR)/debian/xcdroast.desktop \
	$(CURDIR)/debian/xcdroast/usr/share/applications/xcdroast.desktop
install -D -m 644 $(CURDIR)/debian/xcdroast.xpm \
	$(CURDIR)/debian/xcdroast/usr/share/pixmaps/xcdroast.xpm</screen>

			<para>Agora em <filename>dirs</filename>, a linha seguinte necessita de ser adicionada para o ficheiro .desktop ser instalado:</para>
			<screen>usr/share/applications</screen>
			
			<para>Now we need the actual .desktop file (saved as <emphasis>debian/xcdroast.desktop</emphasis>).
				From the ubuntu.debdiff (or the Ubuntu source package), we see that it is:</para>
			<screen>
[Desktop Entry]
Encoding=UTF-8
Name=X-CD-Roast
Comment=Create a CD
Exec=xcdroast
Icon=xcdroast.xpm
Type=Application
Categories=Application;AudioVideo;</screen>
			
			<para>The last change that needs to be made is in <filename>changelog</filename>. 
				Not only do we need to add what we have just done (merge with Debian), but we 
				should also add in the previous &ubuntu; changelog entries. To do this, run 
				<application>dch -i -D dapper</application> and put something to the effect of:</para>
			<screen>
xcdroast (0.98+0alpha15-3<emphasis>ubuntu1</emphasis>) dapper; urgency=low

  * Resynchronise with Debian.</screen>

			<para>Certifique-se de mudar o número da versão para a versão correcta &ubuntu;. Também adicione:</para>
			<screen>
xcdroast (0.98+0alpha15-1.1ubuntu1) breezy; urgency=low

  * Fix and install existing .desktop file. (Closes Malone #2698)
				
  -- Captain Packager &lt;packager@coolness.com&gt; Sat, 1 Oct 2005 19:39:04 -0400</screen>
			<para>entre as entradas 0.98+0alpha15-1.1 e 0.98+0alpha15-2 no log.</para>
			
			<para>Agora pode construir e testar os novos pacotes fonte. Existem maneiras diferentes de fazer isto, mas um exemplo é:</para>
			<screen>
cd ..
debuild -S
cd ..
sudo pbuilder build xcdroast_0.98+0alpha15-3ubuntu1.dsc</screen>
			
			<para>Isto recriará o pacote fonte, assina-o com a sua chave por defeito GPG, e constrói o pacote num ambiente pbuilder para garantir que é criado correctamente. Certifique-se que testa sempre os seus pacotes antes de enviar as correcções. O último passo é fazer um debdiff que pode ser anexado a um relatório de erro existente ou dá-lo aos MOTUs no canal IRC #ubuntu-motu. Para fazer isto, obtemos a diferença entre o pacote fonte instável do Debian e a nova versão &ubuntu;:</para>
			<screen>debdiff xcdroast_0.98+0alpha15-3.dsc xcdroast_0.98+0alpha15-3ubuntu1.dsc &gt; \
	xcdroast_0.98+0alpha15-3ubuntu1.debdiff</screen>
		</sect2>
	</sect1>

	<sect1 id="ubuntu-kubuntu" status="complete">
		<title>Packaging for Kubuntu</title>
		
		<para>Como podemos imaginar, os maiores problemas específicos com o empacotamento para o Kubuntu são o KDE e o Qt.</para>
		
		<sect2 id="build-dependencies">
			<title>Build Dependencies</title>
	
			<para>Os programas Kubuntu são maioritáriamente KDE. Logo, precisam de Build-Depend das <filename>kdelibs4-dev</filename>. Como o foco KDE é ter programas interagindo, alguns programas também precisam do Build-Depend de outras partes do KDE, tais como o <filename>kdepim-dev</filename>. Certifique-se que tem uma lista com as dependências necessárias para o seu programa.</para>
	
		</sect2>

		<sect2 id="desktop-files">
			<title>Ficheiros do Ambiente de Trabalho</title>
		
			<para>O KDE tem alguns caminhos específicos. A maioria das definições do KDE são instaladas em <filename>/etc/kde3/</filename> ou <filename>/usr/share/apps/</filename>. É importante notar que os ficheiros normais do ambiente de trabalho KDE devem ir para <filename>/usr/share/applications/kde/</filename>. O caminho de instalação para os ficheiros do ambiente de trabalho deve ser fixado se não usarem isto (excepto para os ficheiros do ambiente de trabalho como os menus de serviço).</para>
			
			<para>Os ficheiros do ambiente de trabalho KDE também precisam de entadas especificas para se ajustarem ao KMenu. Um ficheiro de ambiente de trabalho básico pode ser algo como isto:</para>
				
			<screen>[Desktop Entry]
Encoding=UTF-8
Name=Kfoo
Name[xx]=Kfoo
GenericName=Bar description
Exec=kfoo
Icon=kfoo
Terminal=false
Categories=Qt;KDE;Utility;</screen>

			<para>Note that the Categories field must begin with Qt;KDE;. There are
				specific desktop file entries for KDE programs and modules that allow su to
				declare the given programs as KCModules or autostart them when logging in.
			</para>
	
		</sect2>
		
		<sect2 id="generating-pot-files">
			<title>Gerando ficheiros .pot</title>

			<para>The Ubuntu translation website, <ulink url="https://launchpad.net/rosetta/">Rosetta</ulink>, now supports KDE,
				which means KDE packages need to support Rosetta by generating .pot
				template files for translators. If you use <application>cdbs</application>
				in edgy, your package should now automatically build and check
				for a .pot file in po/ directory.</para>

			<para>Precisará de <ulink url="../files/kubuntu_01_kdepot.diff">kdepot patch</ulink> (ou similar; pode não aplicar-se correctamente dependendo da idade da directoria admin).</para>

			<para>Se o seu pacote usa o <application>debhelper</application> ou o <application>cdbs</application> e inclui o seu próprio ficheiro kde.mk, precisa de adicionar vocês mesmo as regras.</para>

			<para>Para o <application>cdbs</application>, adicione estas linhas ao <application>cdbs</application>:</para>

			<screen>
common-post-build-arch::
	mkdir -p po
       XGETTEXT=/usr/bin/kde-xgettext sh admin/cvs.sh extract-messages

clean::
       rm -rf po</screen>
			<para>Para o <application>debhelper</application>, adicione o seguinte no fim da regra <emphasis>install</emphasis>:</para>
			<screen>
mkdir -p po
XGETTEXT=/usr/bin/kde-xgettext sh admin/cvs.sh extract-messages</screen>
			<para>Ainda para o <application>debhelper</application>, adicione o seguinte à regra <emphasis>clean</emphasis>:</para>
			<screen>
rm -f po/*.pot</screen>
		</sect2>
		
	</sect1>

</chapter>

