<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" 
        "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % globalent SYSTEM "../../../libs/global.ent">
%globalent;
<!ENTITY % cdo-C SYSTEM "../../../libs/cdo-C.ent">
%cdo-C;
<!ENTITY % pg-common SYSTEM "../pg-common.ent">
%pg-common;
<!ENTITY % xinclude SYSTEM "../../../libs/xinclude.mod">
%xinclude;
<!ENTITY language "en">
<!ENTITY ubuntu '<phrase>Ubuntu</phrase>'>
]>
<chapter id="updating-chap" status="writing">
 		<title>Actualizando Pacotes</title>

			<para>Se usou distribuições Linux durante algum tempo, já precebeu que por vezes há erros nos programas. Nas distribuições Debian e &ubuntu; os erros são muitas vezes corrigidos através do empacotamento, após corrigir o código fonte. Algumas vezes existem bugs no empacotamento em si mesmo que podem causar dificuldades.</para>

			<para>To patch the program's source code, you could simply download
				the current &ubuntu; source package (with
				<application>apt-get source</application>) and make the needed
				changes. You can then add a new entry to the
				<filename>debian/changelog</filename> using
				<application>dch -i</application> or
				<application>dch -v
					&lt;version&gt;-&lt;revision&gt;</application> to specify
				the new revision. When you run <application>debuild
					-S</application> from the source directory you will have a
				new source package with a new <filename>.diff.gz</filename> in the
				parent directory that
				contains your changes. A problem with this approach is that
				the distinction between source and patches is unclear.</para>

			<para>Uma solução para este problema é separar as mudanças ao código fonte em correcções individuais armazenadas no directório <filename>debian</filename>. Este sistema de correcção é chamado <application>dpatch</application>. As correcções são armazenadas no directório <filename>debian/patches/</filename> e têm um formato especial.</para>

			<para>Para criar uma <application>dpatch</application>, execute os passos seguintes sequencialmente.</para>

			<para>Crie um espaço de trabalho temporário e duas cópias da directória fonte actual:</para>
			
			<screen>
mkdir tmp
cd tmp
cp -a ../&lt;package&gt;-&lt;version&gt; . 
cp -a &lt;package&gt;-&lt;version&gt; &lt;package&gt;-&lt;version&gt;.orig 
</screen>

			<para>Efectue as alterações no directório <filename>&lt;package&gt;-&lt;version&gt;</filename>.</para>

			<para>Crie um ficheiro de correcção usando o <application>diff</application> e colocando-o na directoria do <filename>debian/patches</filename>.</para>

			<screen>
diff -Nru &lt;package&gt;-&lt;version&gt;.orig &lt;package&gt;-&lt;version&gt; &gt; patch-file
</screen>

			<para>Crie o <application>dpatch</application> usando <application>dpatch patch-template</application> e um ficheiro chamado <filename>00list</filename> que lista os dpatches:</para>
			<screen>
dpatch patch-template -p "01_patchname" "patch-file description" \
	&lt; patch-file &gt; 01_patchname.dpatch
echo 01_patchname.dpatch &gt;00list</screen>

			<para>Agora pode colocar o <filename>01_patchname.dpatch</filename> e <filename>00list</filename> na directória <filename>debian/patches</filename> do seu pacote fonte.</para>

			<screen>
mkdir ../&lt;package&gt;-&lt;version&gt;/debian/patches
cp 01_patchname.dpatch 00list ../&lt;package&gt;-&lt;version&gt;/debian/patches
cd ..
rm -rf tmp
			</screen>

			<note><para>Pode também editar uma correcção já existente usando o <application>dpatch-edit-patch</application>.</para></note>
			
		<para>Assim que todas as mudanças estiverem efectuadas, uma entrada adicionada no changelog, e o <application>dpatch</application> adicionado ao ficheiro <filename>debian/control</filename> (se necessário), então pode reconstruir o pacote fonte com <application>debuild -S</application>.</para>

		<para>Para conseguir enviar o seu pacote corrigido para os repositórios do &ubuntu;, precisa que alguém com direitos de envio o apoie. Veja <xref linkend="ubuntu-upload"/> para mais detalhes. Algumas vezes, em vez de fornecer todo o pacote fonte (.diff.gz, .dsc, and .orig.tar.gz), é mais fácil e eficiente dar apenas a diferença entre o pacote fonte existente nos repositórios actualmente e o seu pacote corrigido. Foi criada uma ferramenta para o fazer chamada <application>debdiff</application>. Usar o <application>debdiff</application> é semelhante a usar <application>diff</application> mas foi feita especialmente para empacotamento. Pode fazer <application>debdiff</application> ao pacote fonte por:</para>

		<screen>
debdiff &lt;oldpackage&gt;.dsc &lt;newpackage&gt;.dsc &gt; package.debdiff
		</screen>

		<para>ou o pacote bunário por:</para>

		<screen>
debdiff &lt;oldpackage&gt;.deb &lt;newpackage&gt;.deb &gt; package.debdiff
		</screen>
	
		<para>Debdiffs are great to attach to bug reports and have ready for a
			sponsor to upload.</para>
		
</chapter>

